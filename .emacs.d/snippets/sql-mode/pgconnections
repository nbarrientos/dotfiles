# -*- mode: snippet -*-
# name: pgconnections
# key: pgconnections
# expand-env: ((yas-indent-line 'fixed))
# --

/*
      Column      |           Type
------------------+--------------------------
 datid            | oid
 datname          | name
 pid              | integer
 usesysid         | oid
 usename          | name
 application_name | text
 client_addr      | inet
 client_hostname  | text
 client_port      | integer
 backend_start    | timestamp with time zone
 xact_start       | timestamp with time zone
 query_start      | timestamp with time zone
 state_change     | timestamp with time zone
 wait_event_type  | text
 wait_event       | text
 state            | text
 backend_xid      | xid
 backend_xmin     | xid
 query            | text
 backend_type     | text
*/

SELECT
    application_name,
    client_addr,
    client_hostname,
    backend_start,
    state_change
FROM
    pg_stat_activity
WHERE
    datname = '$1'
    ${2:AND application_name LIKE '%${3:application_name}%'}
ORDER BY
    client_addr, backend_start desc;